"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8986],{8986:(I,m,n)=>{n.r(m),n.d(m,{ProfilePageModule:()=>x});var p=n(9808),c=n(4182),g=n(501),l=n(5649),f=n(655),e=n(2096),N=n(9955),h=n(8198),s=n(2321);n(6551);let _=(()=>{class r{constructor(){const o=(0,s.v0)();(0,s.Aj)(o,t=>{t&&(console.log("user",t.uid),this.currentUser=o.currentUser,this.userProfileReference=h.Z.database().ref(`/userProfile/${t.uid}/`),console.log("profile",this.userProfileReference))})}getUserProfileReference(){return console.log("getting usr profile reference"),this.userProfileReference}updateName(o,t){return this.userProfileReference.update({firstName:o,lastName:t})}updateDOB(o){return this.userProfileReference.update({birthDate:{year:o.getFullYear(),month:o.getMonth(),day:o.getDate()}})}updateEmail(o,t){const i=(0,s.v0)(),v=((0,s.gQ)(i.currentUser,t),s.w9.credential(i.currentUser.email,t));return(0,s.aF)(i.currentUser,v).then(()=>{this.updateEmail(i.currentUser.email,o).then(()=>{this.userProfileReference.update({email:o})})}).catch(d=>{console.error(d)})}updatePassword(o,t){const u=(0,s.v0)().currentUser;h.Z.auth.EmailAuthProvider.credential(this.currentUser.email,t),(0,s.gQ)(u,o)}}return r.\u0275fac=function(o){return new(o||r)},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();function Z(r,a){if(1&r&&(e.TgZ(0,"ion-col",12),e._uU(1),e.qZA()),2&r){const o=e.oxw();e.xp6(1),e.hij(" ",null==o.userProfile?null:o.userProfile.firstName," ")}}function T(r,a){1&r&&(e.TgZ(0,"ion-col",13)(1,"span"),e._uU(2," Tap here to edit. "),e.qZA()())}function y(r,a){if(1&r&&(e.TgZ(0,"ion-col",12),e._uU(1),e.qZA()),2&r){const o=e.oxw();e.xp6(1),e.hij(" ",null==o.userProfile?null:o.userProfile.lastName," ")}}function U(r,a){1&r&&(e.TgZ(0,"ion-col",13)(1,"span"),e._uU(2," Tap here to edit. "),e.qZA()())}function A(r,a){if(1&r&&(e.TgZ(0,"ion-col",12),e._uU(1),e.qZA()),2&r){const o=e.oxw();e.xp6(1),e.hij(" ",null==o.userProfile?null:o.userProfile.email," ")}}function w(r,a){1&r&&(e.TgZ(0,"ion-col",13)(1,"span"),e._uU(2," Tap here to edit. "),e.qZA()())}const Y=[{path:"",component:(()=>{class r{constructor(o,t,i,u){this.alertCtrl=o,this.authService=t,this.profileService=i,this.router=u}ngOnInit(){console.log("init profile"),this.userProfile={firstName:"nome",lastName:"cognome"},this.profileService.getUserProfileReference()&&(console.log("getting profile"),this.profileService.getUserProfileReference().on("value",o=>{if(console.log("got profile",o),this.userProfile=o.val()||{firstName:"",lastName:""},this.userProfile.birthDate){var t=new Date;t.setFullYear(this.userProfile.birthDate.year),t.setMonth(Number(this.userProfile.birthDate.month)),t.setDate(this.userProfile.birthDate.day),this.birthDate=t.toISOString()}}))}logOut(){this.authService.logoutUser().then(()=>{this.router.navigateByUrl("login")})}updateName(){return(0,f.mG)(this,void 0,void 0,function*(){yield(yield this.alertCtrl.create({subHeader:"Il tuo nome e cognome",inputs:[{type:"text",name:"firstName",placeholder:"Il tuo Nome",value:this.userProfile?this.userProfile.firstName:""},{type:"text",name:"lastName",placeholder:"Il tuo Cognome",value:this.userProfile?this.userProfile.lastName:""}],buttons:[{text:"Annulla"},{text:"Salva",handler:t=>{this.userProfile.firstName=t.firstName,this.userProfile.lastName=t.lastName,this.profileService.updateName(t.firstName,t.lastName).then(i=>{console.log("updated",i)})}}]})).present()})}extract_date_from_data(o){return o.split("T")[0].split("-")}makeup_date(o){return{year:Number(o[0]),month:Number(o[1]),day:Number(o[2])}}changedDate(o){}updateDOB(o,t){if(void 0===(o=this.makeup_date(this.extract_date_from_data(o))))return;if(void 0===o.year||void 0===o.month||void 0===o.day)return;const i=new Date(o.year,o.month-1,o.day);this.profileService.updateDOB(i)}updateEmail(){return(0,f.mG)(this,void 0,void 0,function*(){yield(yield this.alertCtrl.create({inputs:[{type:"text",name:"newEmail",placeholder:"la tua nuova mail"},{name:"password",placeholder:"la tua password",type:"password"}],buttons:[{text:"Annulla"},{text:"Salva",handler:t=>{this.profileService.updateEmail(t.newEmail,t.password).then(()=>{}).catch(i=>{console.log("ERROR: "+i.message)})}}]})).present()})}updatePassword(){return(0,f.mG)(this,void 0,void 0,function*(){yield(yield this.alertCtrl.create({inputs:[{name:"newPassword",placeholder:"Nuova password",type:"password"},{name:"oldPassword",placeholder:"Vecchia password",type:"password"}],buttons:[{text:"Annulla"},{text:"Salva",handler:t=>{this.profileService.updatePassword(t.newPassword,t.oldPassword)}}]})).present()})}}return r.\u0275fac=function(o){return new(o||r)(e.Y36(l.Br),e.Y36(N.e),e.Y36(_),e.Y36(g.F0))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-profile"]],decls:47,vars:7,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],[3,"click"],["slot","icon-only","name","log-out"],["padding",""],["size","5",1,"text-left"],["class","text-center","size","7",4,"ngIf"],["size","7","class","placeholder-profile text-center",4,"ngIf"],[1,"dob-label"],["displayFormat","MMM D, YYYY","pickerFormat","D MMM YYYY",3,"ngModel","ngModelChange","ionChange"],["size","7",1,"placeholder-profile"],["size","7",1,"text-center"],["size","7",1,"placeholder-profile","text-center"]],template:function(o,t){1&o&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e._uU(3,"profile"),e.qZA(),e.TgZ(4,"ion-buttons",0),e._UZ(5,"ion-back-button",1),e.qZA(),e.TgZ(6,"ion-buttons",2)(7,"ion-button",3),e.NdJ("click",function(){return t.logOut()}),e._UZ(8,"ion-icon",4),e.qZA()()()(),e.TgZ(9,"ion-content",5)(10,"ion-list")(11,"ion-list-header"),e._uU(12," Personal Information "),e.qZA(),e.TgZ(13,"ion-item",3),e.NdJ("click",function(){return t.updateName()}),e.TgZ(14,"ion-label")(15,"ion-grid")(16,"ion-row")(17,"ion-col",6),e._uU(18," Nome "),e.qZA(),e.YNc(19,Z,2,1,"ion-col",7),e.YNc(20,T,3,0,"ion-col",8),e.qZA(),e.TgZ(21,"ion-row")(22,"ion-col",6),e._uU(23," Cognome "),e.qZA(),e.YNc(24,y,2,1,"ion-col",7),e.YNc(25,U,3,0,"ion-col",8),e.qZA()()()(),e.TgZ(26,"ion-item")(27,"ion-label",9),e._uU(28,"Data di Nascita"),e.qZA(),e.TgZ(29,"ion-datetime",10),e.NdJ("ngModelChange",function(u){return t.birthDate=u})("ionChange",function(u){return t.updateDOB(t.birthDate,u)}),e.qZA()(),e.TgZ(30,"ion-item",3),e.NdJ("click",function(){return t.updateEmail()}),e.TgZ(31,"ion-label")(32,"ion-grid")(33,"ion-row")(34,"ion-col",6),e._uU(35," Email "),e.qZA(),e.YNc(36,A,2,1,"ion-col",7),e.YNc(37,w,3,0,"ion-col",8),e.qZA()()()(),e.TgZ(38,"ion-item",3),e.NdJ("click",function(){return t.updatePassword()}),e.TgZ(39,"ion-label")(40,"ion-grid")(41,"ion-row")(42,"ion-col",6),e._uU(43," Password "),e.qZA(),e.TgZ(44,"ion-col",11)(45,"span"),e._uU(46," Tap here to edit. "),e.qZA()()()()()()()()),2&o&&(e.xp6(19),e.Q6J("ngIf",(null==t.userProfile?null:t.userProfile.firstName)||(null==t.userProfile?null:t.userProfile.lastName)),e.xp6(1),e.Q6J("ngIf",!(null!=t.userProfile&&t.userProfile.firstName)),e.xp6(4),e.Q6J("ngIf",(null==t.userProfile?null:t.userProfile.firstName)||(null==t.userProfile?null:t.userProfile.lastName)),e.xp6(1),e.Q6J("ngIf",!(null!=t.userProfile&&t.userProfile.firstName)),e.xp6(4),e.Q6J("ngModel",t.birthDate),e.xp6(7),e.Q6J("ngIf",null==t.userProfile?null:t.userProfile.email),e.xp6(1),e.Q6J("ngIf",!(null!=t.userProfile&&t.userProfile.email)))},directives:[l.Gu,l.sr,l.wd,l.Sm,l.oU,l.cs,l.YG,l.gu,l.W2,l.q_,l.yh,l.Ie,l.Q$,l.jY,l.Nd,l.wI,p.O5,l.x4,l.QI,c.JJ,c.On],styles:[""]}),r})()}];let x=(()=>{class r{}return r.\u0275fac=function(o){return new(o||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[p.ez,c.u5,l.Pc,g.Bz.forChild(Y)]]}),r})()}}]);